<!DOCTYPE html>
<html>
  <head>
    <title>Markdown Editor</title>
    <style>
      #editor,
      #preview {
        width: 48%;
        height: 400px;
        border: 1px solid #ccc;
        padding: 10px;
        float: left;
        box-sizing: border-box; /* Include padding and border in element's total width and height */
      }
      #preview {
        margin-left: 2%; /* Add some space between editor and preview */
        overflow-y: auto; /* Make preview scrollable if content overflows */
      }
      .toolbar button {
        margin: 5px;
      }
    </style>
  </head>
  <body>
    <h1>Markdown Editor</h1>

    <div class="toolbar">
      <button onclick="formatText('bold')">Bold</button>
      <button onclick="formatText('italic')">Italic</button>
      <button onclick="formatText('header')">Header</button>
      <button onclick="formatText('link')">Link</button>
      <button onclick="formatText('list')">List</button>
    </div>

    <textarea id="editor"></textarea>
    <div id="preview"></div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      const editor = document.getElementById("editor");
      const preview = document.getElementById("preview");

      function updatePreview() {
        preview.innerHTML = marked.parse(editor.value);
        localStorage.setItem("markdown", editor.value); // Autosave
      }

      function formatText(type) {
        let selectedText = editor.value.substring(
          editor.selectionStart,
          editor.selectionEnd
        );
        let beforeText = editor.value.substring(0, editor.selectionStart);
        let afterText = editor.value.substring(editor.selectionEnd);

        switch (type) {
          case "bold":
            editor.value = beforeText + "**" + selectedText + "**" + afterText;
            break;
          case "italic":
            editor.value = beforeText + "*" + selectedText + "*" + afterText;
            break;
          case "header":
            editor.value = beforeText + "# " + selectedText + afterText;
            break;
          case "link":
            let url = prompt("Enter URL:");
            editor.value =
              beforeText + "[" + selectedText + "](" + url + ")" + afterText;
            break;
          case "list":
            let listItems = selectedText.split("\n");
            let formattedList = listItems.map((item) => "- " + item).join("\n");
            editor.value = beforeText + formattedList + afterText;
            break;
        }

        updatePreview();

        // Maintain cursor position after formatting (crucial for UX)
        editor.focus(); // Ensure focus is on the textarea
        editor.setSelectionRange(beforeText.length, beforeText.length); // Set cursor after opening tag
      }

      editor.addEventListener("input", updatePreview);

      // Load saved markdown on startup
      const savedMarkdown = localStorage.getItem("markdown");
      if (savedMarkdown) {
        editor.value = savedMarkdown;
        updatePreview();
      }
    </script>
  </body>
</html>
